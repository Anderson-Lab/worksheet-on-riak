{
  "name": "Worksheet on Riak",
  "tagline": "DATA 210 - Spring 2016",
  "body": "# Installation\r\n1. wget https://packagecloud.io/basho/riak/packages/ubuntu/trusty/riak_2.1.1-1_amd64.deb/download -O riak_2.1.1-1_amd64.deb\r\n2. sudo apt-get update\r\n3. sudo dpkg -i riak_2.1.1-1_amd64.deb\r\n\r\n# Starting Riak\r\n1. Edit /etc/riak/riak.conf changing the line that says listener.http.internal = 127.0.0.1:8098 to listener.http.internal = 0.0.0.0:8098. (e.g., sudo nano /etc/riak/riak.conf)\r\n2. sudo riak start # This start riak running on port 8098.\r\n3. Set up port forwarding in Virtualbox for port 8098 to 8098 just like we did for Jupyterhub, which is under Settings->Networking-Port Forwarding.\r\n\r\n# Questions\r\n1. Create a webpage in Riak in a bucket called test with a key called data210. Set the MIME type to text/html and set the content to a webpage that says Welcome to DATA 210. I love Riak. Once this is done, go to your browser and navigate to http://localhost:8098/test/data210. What do you see?\r\n\r\n2. Now create a bucket that contains information about the Anderson family doggies. Use the example we went over in class to store each dog by their name in the same bucket. There are three dogs named Layla, Armani, and Orion. They are a \"rhodesian ridgeback\", \"catahoula\", and a \"great dane/shepherd mix\", respectively. Use JSON to store the type of dog and the age which is Layla is 3 years, Armani is 2 years, and Orion is 6 years old. Once you store them, make sure you can GET the value of each key you created.\r\n\r\n3. Now create a new key/value relationship called cage 1, and assign Layla to that cage using a link.\r\n\r\n4. Now go into your browser and GET the information for Orion.\r\n\r\n5. Now go ahead and delete orion from the database.\r\n\r\n# Map-reduce\r\nNow create the following database, and execute the following map-reduce command. What does this map reduce command do? Why do we need to do this? Why would this sometimes be good and sometimes be bad?\r\n\r\n```\r\ncurl -XPUT -H \"content-type: text/plain\" \\\r\n    http://localhost:8098/riak/alice/p1 --data-binary @-<<\\EOF\r\nAlice was beginning to get very tired of sitting by her sister on the\r\nbank, and of having nothing to do: once or twice she had peeped into the\r\nbook her sister was reading, but it had no pictures or conversations in\r\nit, 'and what is the use of a book,' thought Alice 'without pictures or\r\nconversation?'\r\nEOF\r\n\r\ncurl -XPUT -H \"content-type: text/plain\" \\\r\n    http://localhost:8098/riak/alice/p2 --data-binary @-<<\\EOF\r\nSo she was considering in her own mind (as well as she could, for the\r\nhot day made her feel very sleepy and stupid), whether the pleasure\r\nof making a daisy-chain would be worth the trouble of getting up and\r\npicking the daisies, when suddenly a White Rabbit with pink eyes ran\r\nclose by her.\r\nEOF\r\n\r\ncurl -XPUT -H \"content-type: text/plain\" \\\r\n    http://localhost:8098/riak/alice/p5 --data-binary @-<<\\EOF\r\nThe rabbit-hole went straight on like a tunnel for some way, and then\r\ndipped suddenly down, so suddenly that Alice had not a moment to think\r\nabout stopping herself before she found herself falling down a very deep\r\nwell.\r\nEOF\r\n```\r\n\r\nNow you can do the word count example using Riak:\r\n```\r\ncurl -X POST -H \"content-type: application/json\" \\\r\n    http://localhost:8098/mapred --data @-<<\\EOF\r\n{\"inputs\":[[\"alice\",\"p1\"],[\"alice\",\"p2\"],[\"alice\",\"p5\"]]\r\n,\"query\":[{\"map\":{\"language\":\"javascript\",\"source\":\"\r\nfunction(v) {\r\n  var m = v.values[0].data.toLowerCase().match(/\\w*/g);\r\n  var r = [];\r\n  for(var i in m) {\r\n    if(m[i] != '') {\r\n      var o = {};\r\n      o[m[i]] = 1;\r\n      r.push(o);\r\n    }\r\n  }\r\n  return r;\r\n}\r\n\"}},{\"reduce\":{\"language\":\"javascript\",\"source\":\"\r\nfunction(v) {\r\n  var r = {};\r\n  for(var i in v) {\r\n    for(var w in v[i]) {\r\n      if(w in r) r[w] += v[i][w];\r\n      else r[w] = v[i][w];\r\n    }\r\n  }\r\n  return [r];\r\n}\r\n\"}}]}\r\nEOF\r\n```\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}